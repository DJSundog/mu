<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Mu - 047check_type_by_name.cc</title>
<meta name="Generator" content="Vim/7.4">
<meta name="plugin-version" content="vim7.4_v2">
<meta name="syntax" content="cpp">
<meta name="settings" content="number_lines,use_css,pre_wrap,no_foldcolumn,expand_tabs,line_ids,prevent_copy=">
<meta name="colorscheme" content="minimal">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #eeeeee; background-color: #080808; }
body { font-size: 12pt; font-family: monospace; color: #eeeeee; background-color: #080808; }
* { font-size: 12pt; font-size: 1em; }
.Constant { color: #00a0a0; }
.traceAbsent { color: #c00000; }
.Special { color: #c00000; }
.muRecipe { color: #ff8700; }
.cSpecial { color: #008000; }
.Comment { color: #9090ff; }
.Delimiter { color: #800080; }
.LineNr { color: #444444; }
.traceContains { color: #008000; }
.Normal { color: #eeeeee; background-color: #080808; padding-bottom: 1px; }
.Identifier { color: #c0a020; }
-->
</style>

<script type='text/javascript'>
<!--

/* function to open any folds containing a jumped-to line before jumping to it */
function JumpToLine()
{
  var lineNum;
  lineNum = window.location.hash;
  lineNum = lineNum.substr(1); /* strip off '#' */

  if (lineNum.indexOf('L') == -1) {
    lineNum = 'L'+lineNum;
  }
  lineElem = document.getElementById(lineNum);
  /* Always jump to new location even if the line was hidden inside a fold, or
   * we corrected the raw number to a line ID.
   */
  if (lineElem) {
    lineElem.scrollIntoView(true);
  }
  return true;
}
if ('onhashchange' in window) {
  window.onhashchange = JumpToLine;
}

-->
</script>
</head>
<body onload='JumpToLine();'>
<pre id='vimCodeElement'>
<a name="L1"></a><span id="L1" class="LineNr">  1 </span><span class="Comment">//: Some simple sanity checks for types, and also attempts to guess them where</span>
<a name="L2"></a><span id="L2" class="LineNr">  2 </span><span class="Comment">//: they aren't provided.</span>
<a name="L3"></a><span id="L3" class="LineNr">  3 </span><span class="Comment">//:</span>
<a name="L4"></a><span id="L4" class="LineNr">  4 </span><span class="Comment">//: You still have to provide the full type the first time you mention a</span>
<a name="L5"></a><span id="L5" class="LineNr">  5 </span><span class="Comment">//: variable in a recipe. You have to explicitly name :offset and :variant</span>
<a name="L6"></a><span id="L6" class="LineNr">  6 </span><span class="Comment">//: every single time. You can't use the same name with multiple types in a</span>
<a name="L7"></a><span id="L7" class="LineNr">  7 </span><span class="Comment">//: single recipe.</span>
<a name="L8"></a><span id="L8" class="LineNr">  8 </span>
<a name="L9"></a><span id="L9" class="LineNr">  9 </span><span class="Delimiter">:(scenario transform_fails_on_reusing_name_with_different_type)</span>
<a name="L10"></a><span id="L10" class="LineNr"> 10 </span><span class="Special">% Hide_errors = true;</span>
<a name="L11"></a><span id="L11" class="LineNr"> 11 </span><span class="muRecipe">def</span> main [
<a name="L12"></a><span id="L12" class="LineNr"> 12 </span>  <span class="Normal">x</span>:num<span class="Special"> &lt;- </span>copy <span class="Constant">1</span>
<a name="L13"></a><span id="L13" class="LineNr"> 13 </span>  <span class="Normal">x</span>:<span class="Normal">bool</span><span class="Special"> &lt;- </span>copy <span class="Constant">1</span>
<a name="L14"></a><span id="L14" class="LineNr"> 14 </span>]
<a name="L15"></a><span id="L15" class="LineNr"> 15 </span><span class="traceContains">+error: main: 'x' used with multiple types</span>
<a name="L16"></a><span id="L16" class="LineNr"> 16 </span>
<a name="L17"></a><span id="L17" class="LineNr"> 17 </span><span class="Delimiter">:(after &quot;Transform.push_back(expand_type_abbreviations)&quot;)</span>
<a name="L18"></a><span id="L18" class="LineNr"> 18 </span>Transform<span class="Delimiter">.</span>push_back<span class="Delimiter">(</span>check_or_set_types_by_name<span class="Delimiter">);</span>  <span class="Comment">// idempotent</span>
<a name="L19"></a><span id="L19" class="LineNr"> 19 </span>
<a name="L20"></a><span id="L20" class="LineNr"> 20 </span><span class="Delimiter">:(code)</span>
<a name="L21"></a><span id="L21" class="LineNr"> 21 </span><span class="Normal">void</span> check_or_set_types_by_name<span class="Delimiter">(</span><span class="Normal">const</span> recipe_ordinal r<span class="Delimiter">)</span> <span class="Delimiter">{</span>
<a name="L22"></a><span id="L22" class="LineNr"> 22 </span>  trace<span class="Delimiter">(</span><span class="Constant">9991</span><span class="Delimiter">,</span> <span class="Constant">&quot;transform&quot;</span><span class="Delimiter">)</span> &lt;&lt; <span class="Constant">&quot;--- deduce types for recipe &quot;</span> &lt;&lt; get<span class="Delimiter">(</span>Recipe<span class="Delimiter">,</span> r<span class="Delimiter">).</span>name &lt;&lt; end<span class="Delimiter">();</span>
<a name="L23"></a><span id="L23" class="LineNr"> 23 </span>  recipe&amp; caller = get<span class="Delimiter">(</span>Recipe<span class="Delimiter">,</span> r<span class="Delimiter">);</span>
<a name="L24"></a><span id="L24" class="LineNr"> 24 </span>  set&lt;reagent&gt; known<span class="Delimiter">;</span>
<a name="L25"></a><span id="L25" class="LineNr"> 25 </span>  <span class="Normal">for</span> <span class="Delimiter">(</span><span class="Normal">int</span> i = <span class="Constant">0</span><span class="Delimiter">;</span>  i &lt; SIZE<span class="Delimiter">(</span>caller<span class="Delimiter">.</span>steps<span class="Delimiter">);</span>  ++i<span class="Delimiter">)</span> <span class="Delimiter">{</span>
<a name="L26"></a><span id="L26" class="LineNr"> 26 </span>    instruction&amp; inst = caller<span class="Delimiter">.</span>steps<span class="Delimiter">.</span>at<span class="Delimiter">(</span>i<span class="Delimiter">);</span>
<a name="L27"></a><span id="L27" class="LineNr"> 27 </span>    <span class="Normal">for</span> <span class="Delimiter">(</span><span class="Normal">int</span> in = <span class="Constant">0</span><span class="Delimiter">;</span>  in &lt; SIZE<span class="Delimiter">(</span>inst<span class="Delimiter">.</span>ingredients<span class="Delimiter">);</span>  ++in<span class="Delimiter">)</span> <span class="Delimiter">{</span>
<a name="L28"></a><span id="L28" class="LineNr"> 28 </span>      deduce_missing_type<span class="Delimiter">(</span>known<span class="Delimiter">,</span> inst<span class="Delimiter">.</span>ingredients<span class="Delimiter">.</span>at<span class="Delimiter">(</span>in<span class="Delimiter">));</span>
<a name="L29"></a><span id="L29" class="LineNr"> 29 </span>      check_type<span class="Delimiter">(</span>known<span class="Delimiter">,</span> inst<span class="Delimiter">.</span>ingredients<span class="Delimiter">.</span>at<span class="Delimiter">(</span>in<span class="Delimiter">),</span> caller<span class="Delimiter">);</span>
<a name="L30"></a><span id="L30" class="LineNr"> 30 </span>    <span class="Delimiter">}</span>
<a name="L31"></a><span id="L31" class="LineNr"> 31 </span>    <span class="Normal">for</span> <span class="Delimiter">(</span><span class="Normal">int</span> out = <span class="Constant">0</span><span class="Delimiter">;</span>  out &lt; SIZE<span class="Delimiter">(</span>inst<span class="Delimiter">.</span>products<span class="Delimiter">);</span>  ++out<span class="Delimiter">)</span> <span class="Delimiter">{</span>
<a name="L32"></a><span id="L32" class="LineNr"> 32 </span>      deduce_missing_type<span class="Delimiter">(</span>known<span class="Delimiter">,</span> inst<span class="Delimiter">.</span>products<span class="Delimiter">.</span>at<span class="Delimiter">(</span>out<span class="Delimiter">));</span>
<a name="L33"></a><span id="L33" class="LineNr"> 33 </span>      check_type<span class="Delimiter">(</span>known<span class="Delimiter">,</span> inst<span class="Delimiter">.</span>products<span class="Delimiter">.</span>at<span class="Delimiter">(</span>out<span class="Delimiter">),</span> caller<span class="Delimiter">);</span>
<a name="L34"></a><span id="L34" class="LineNr"> 34 </span>    <span class="Delimiter">}</span>
<a name="L35"></a><span id="L35" class="LineNr"> 35 </span>  <span class="Delimiter">}</span>
<a name="L36"></a><span id="L36" class="LineNr"> 36 </span><span class="Delimiter">}</span>
<a name="L37"></a><span id="L37" class="LineNr"> 37 </span>
<a name="L38"></a><span id="L38" class="LineNr"> 38 </span><span class="Normal">void</span> deduce_missing_type<span class="Delimiter">(</span>set&lt;reagent&gt;&amp; known<span class="Delimiter">,</span> reagent&amp; x<span class="Delimiter">)</span> <span class="Delimiter">{</span>
<a name="L39"></a><span id="L39" class="LineNr"> 39 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>x<span class="Delimiter">.</span>type<span class="Delimiter">)</span> <span class="Identifier">return</span><span class="Delimiter">;</span>
<a name="L40"></a><span id="L40" class="LineNr"> 40 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>is_jump_target<span class="Delimiter">(</span>x<span class="Delimiter">.</span>name<span class="Delimiter">))</span> <span class="Delimiter">{</span>
<a name="L41"></a><span id="L41" class="LineNr"> 41 </span>    x<span class="Delimiter">.</span>type = <span class="Normal">new</span> type_tree<span class="Delimiter">(</span><span class="Constant">&quot;label&quot;</span><span class="Delimiter">);</span>
<a name="L42"></a><span id="L42" class="LineNr"> 42 </span>    <span class="Identifier">return</span><span class="Delimiter">;</span>
<a name="L43"></a><span id="L43" class="LineNr"> 43 </span>  <span class="Delimiter">}</span>
<a name="L44"></a><span id="L44" class="LineNr"> 44 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>known<span class="Delimiter">.</span>find<span class="Delimiter">(</span>x<span class="Delimiter">)</span> == known<span class="Delimiter">.</span>end<span class="Delimiter">())</span> <span class="Identifier">return</span><span class="Delimiter">;</span>
<a name="L45"></a><span id="L45" class="LineNr"> 45 </span>  x<span class="Delimiter">.</span>type = <span class="Normal">new</span> type_tree<span class="Delimiter">(</span>*known<span class="Delimiter">.</span>find<span class="Delimiter">(</span>x<span class="Delimiter">)-&gt;</span>type<span class="Delimiter">);</span>
<a name="L46"></a><span id="L46" class="LineNr"> 46 </span>  trace<span class="Delimiter">(</span><span class="Constant">9992</span><span class="Delimiter">,</span> <span class="Constant">&quot;transform&quot;</span><span class="Delimiter">)</span> &lt;&lt; x<span class="Delimiter">.</span>name &lt;&lt; <span class="Constant">&quot; &lt;= &quot;</span> &lt;&lt; names_to_string<span class="Delimiter">(</span>x<span class="Delimiter">.</span>type<span class="Delimiter">)</span> &lt;&lt; end<span class="Delimiter">();</span>
<a name="L47"></a><span id="L47" class="LineNr"> 47 </span><span class="Delimiter">}</span>
<a name="L48"></a><span id="L48" class="LineNr"> 48 </span>
<a name="L49"></a><span id="L49" class="LineNr"> 49 </span><span class="Normal">void</span> check_type<span class="Delimiter">(</span>set&lt;reagent&gt;&amp; known<span class="Delimiter">,</span> <span class="Normal">const</span> reagent&amp; x<span class="Delimiter">,</span> <span class="Normal">const</span> recipe&amp; caller<span class="Delimiter">)</span> <span class="Delimiter">{</span>
<a name="L50"></a><span id="L50" class="LineNr"> 50 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>is_literal<span class="Delimiter">(</span>x<span class="Delimiter">))</span> <span class="Identifier">return</span><span class="Delimiter">;</span>
<a name="L51"></a><span id="L51" class="LineNr"> 51 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>is_integer<span class="Delimiter">(</span>x<span class="Delimiter">.</span>name<span class="Delimiter">))</span> <span class="Identifier">return</span><span class="Delimiter">;</span>  <span class="Comment">// if you use raw locations you're probably doing something unsafe</span>
<a name="L52"></a><span id="L52" class="LineNr"> 52 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>!x<span class="Delimiter">.</span>type<span class="Delimiter">)</span> <span class="Identifier">return</span><span class="Delimiter">;</span>  <span class="Comment">// might get filled in by other logic later</span>
<a name="L53"></a><span id="L53" class="LineNr"> 53 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>is_jump_target<span class="Delimiter">(</span>x<span class="Delimiter">.</span>name<span class="Delimiter">))</span> <span class="Delimiter">{</span>
<a name="L54"></a><span id="L54" class="LineNr"> 54 </span>    <span class="Normal">if</span> <span class="Delimiter">(</span>!x<span class="Delimiter">.</span>type<span class="Delimiter">-&gt;</span>atom || x<span class="Delimiter">.</span>type<span class="Delimiter">-&gt;</span>name != <span class="Constant">&quot;label&quot;</span><span class="Delimiter">)</span>
<a name="L55"></a><span id="L55" class="LineNr"> 55 </span>      raise &lt;&lt; maybe<span class="Delimiter">(</span>caller<span class="Delimiter">.</span>name<span class="Delimiter">)</span> &lt;&lt; <span class="Constant">&quot;non-label '&quot;</span> &lt;&lt; x<span class="Delimiter">.</span>name &lt;&lt; <span class="Constant">&quot;' must begin with a letter</span><span class="cSpecial">\n</span><span class="Constant">&quot;</span> &lt;&lt; end<span class="Delimiter">();</span>
<a name="L56"></a><span id="L56" class="LineNr"> 56 </span>    <span class="Identifier">return</span><span class="Delimiter">;</span>
<a name="L57"></a><span id="L57" class="LineNr"> 57 </span>  <span class="Delimiter">}</span>
<a name="L58"></a><span id="L58" class="LineNr"> 58 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>known<span class="Delimiter">.</span>find<span class="Delimiter">(</span>x<span class="Delimiter">)</span> == known<span class="Delimiter">.</span>end<span class="Delimiter">())</span> <span class="Delimiter">{</span>
<a name="L59"></a><span id="L59" class="LineNr"> 59 </span>    trace<span class="Delimiter">(</span><span class="Constant">9992</span><span class="Delimiter">,</span> <span class="Constant">&quot;transform&quot;</span><span class="Delimiter">)</span> &lt;&lt; x<span class="Delimiter">.</span>name &lt;&lt; <span class="Constant">&quot; =&gt; &quot;</span> &lt;&lt; names_to_string<span class="Delimiter">(</span>x<span class="Delimiter">.</span>type<span class="Delimiter">)</span> &lt;&lt; end<span class="Delimiter">();</span>
<a name="L60"></a><span id="L60" class="LineNr"> 60 </span>    known<span class="Delimiter">.</span>insert<span class="Delimiter">(</span>x<span class="Delimiter">);</span>
<a name="L61"></a><span id="L61" class="LineNr"> 61 </span>  <span class="Delimiter">}</span>
<a name="L62"></a><span id="L62" class="LineNr"> 62 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>!types_strictly_match<span class="Delimiter">(</span>known<span class="Delimiter">.</span>find<span class="Delimiter">(</span>x<span class="Delimiter">)-&gt;</span>type<span class="Delimiter">,</span> x<span class="Delimiter">.</span>type<span class="Delimiter">))</span> <span class="Delimiter">{</span>
<a name="L63"></a><span id="L63" class="LineNr"> 63 </span>    raise &lt;&lt; maybe<span class="Delimiter">(</span>caller<span class="Delimiter">.</span>name<span class="Delimiter">)</span> &lt;&lt; <span class="Constant">&quot;'&quot;</span> &lt;&lt; x<span class="Delimiter">.</span>name &lt;&lt; <span class="Constant">&quot;' used with multiple types</span><span class="cSpecial">\n</span><span class="Constant">&quot;</span> &lt;&lt; end<span class="Delimiter">();</span>
<a name="L64"></a><span id="L64" class="LineNr"> 64 </span>    <span class="Identifier">return</span><span class="Delimiter">;</span>
<a name="L65"></a><span id="L65" class="LineNr"> 65 </span>  <span class="Delimiter">}</span>
<a name="L66"></a><span id="L66" class="LineNr"> 66 </span>  <span class="Normal">if</span> <span class="Delimiter">(</span>is_mu_array<span class="Delimiter">(</span>x<span class="Delimiter">))</span> <span class="Delimiter">{</span>
<a name="L67"></a><span id="L67" class="LineNr"> 67 </span>    <span class="Normal">if</span> <span class="Delimiter">(</span>!x<span class="Delimiter">.</span>type<span class="Delimiter">-&gt;</span>right<span class="Delimiter">)</span> <span class="Delimiter">{</span>
<a name="L68"></a><span id="L68" class="LineNr"> 68 </span>      raise &lt;&lt; maybe<span class="Delimiter">(</span>caller<span class="Delimiter">.</span>name<span class="Delimiter">)</span> &lt;&lt; <span class="Constant">&quot;'&quot;</span> &lt;&lt; x<span class="Delimiter">.</span>name &lt;&lt; <span class="Constant">&quot;: can't be just an array. What is it an array of?</span><span class="cSpecial">\n</span><span class="Constant">&quot;</span> &lt;&lt; end<span class="Delimiter">();</span>
<a name="L69"></a><span id="L69" class="LineNr"> 69 </span>      <span class="Identifier">return</span><span class="Delimiter">;</span>
<a name="L70"></a><span id="L70" class="LineNr"> 70 </span>    <span class="Delimiter">}</span>
<a name="L71"></a><span id="L71" class="LineNr"> 71 </span>    <span class="Normal">if</span> <span class="Delimiter">(</span>!x<span class="Delimiter">.</span>type<span class="Delimiter">-&gt;</span>right<span class="Delimiter">-&gt;</span>right<span class="Delimiter">)</span> <span class="Delimiter">{</span>
<a name="L72"></a><span id="L72" class="LineNr"> 72 </span>      raise &lt;&lt; caller<span class="Delimiter">.</span>name &lt;&lt; <span class="Constant">&quot; can't determine the size of array variable '&quot;</span> &lt;&lt; x<span class="Delimiter">.</span>name &lt;&lt; <span class="Constant">&quot;'. Either allocate it separately and make the type of '&quot;</span> &lt;&lt; x<span class="Delimiter">.</span>name &lt;&lt; <span class="Constant">&quot;' an address, or specify the length of the array in the type of '&quot;</span> &lt;&lt; x<span class="Delimiter">.</span>name &lt;&lt; <span class="Constant">&quot;'.</span><span class="cSpecial">\n</span><span class="Constant">&quot;</span> &lt;&lt; end<span class="Delimiter">();</span>
<a name="L73"></a><span id="L73" class="LineNr"> 73 </span>      <span class="Identifier">return</span><span class="Delimiter">;</span>
<a name="L74"></a><span id="L74" class="LineNr"> 74 </span>    <span class="Delimiter">}</span>
<a name="L75"></a><span id="L75" class="LineNr"> 75 </span>  <span class="Delimiter">}</span>
<a name="L76"></a><span id="L76" class="LineNr"> 76 </span><span class="Delimiter">}</span>
<a name="L77"></a><span id="L77" class="LineNr"> 77 </span>
<a name="L78"></a><span id="L78" class="LineNr"> 78 </span><span class="Delimiter">:(scenario transform_fills_in_missing_types)</span>
<a name="L79"></a><span id="L79" class="LineNr"> 79 </span><span class="muRecipe">def</span> main [
<a name="L80"></a><span id="L80" class="LineNr"> 80 </span>  <span class="Normal">x</span>:num<span class="Special"> &lt;- </span>copy <span class="Constant">1</span>
<a name="L81"></a><span id="L81" class="LineNr"> 81 </span>  <span class="Normal">y</span>:num<span class="Special"> &lt;- </span>add x<span class="Delimiter">,</span> <span class="Constant">1</span>
<a name="L82"></a><span id="L82" class="LineNr"> 82 </span>]
<a name="L83"></a><span id="L83" class="LineNr"> 83 </span><span class="Comment"># x is in location 1, y in location 2</span>
<a name="L84"></a><span id="L84" class="LineNr"> 84 </span><span class="traceContains">+mem: storing 2 in location 2</span>
<a name="L85"></a><span id="L85" class="LineNr"> 85 </span>
<a name="L86"></a><span id="L86" class="LineNr"> 86 </span><span class="Delimiter">:(scenario transform_fills_in_missing_types_in_product)</span>
<a name="L87"></a><span id="L87" class="LineNr"> 87 </span><span class="muRecipe">def</span> main [
<a name="L88"></a><span id="L88" class="LineNr"> 88 </span>  <span class="Normal">x</span>:num<span class="Special"> &lt;- </span>copy <span class="Constant">1</span>
<a name="L89"></a><span id="L89" class="LineNr"> 89 </span>  x<span class="Special"> &lt;- </span>copy <span class="Constant">2</span>
<a name="L90"></a><span id="L90" class="LineNr"> 90 </span>]
<a name="L91"></a><span id="L91" class="LineNr"> 91 </span><span class="Comment"># x is in location 1</span>
<a name="L92"></a><span id="L92" class="LineNr"> 92 </span><span class="traceContains">+mem: storing 2 in location 1</span>
<a name="L93"></a><span id="L93" class="LineNr"> 93 </span>
<a name="L94"></a><span id="L94" class="LineNr"> 94 </span><span class="Delimiter">:(scenario transform_fills_in_missing_types_in_product_and_ingredient)</span>
<a name="L95"></a><span id="L95" class="LineNr"> 95 </span><span class="muRecipe">def</span> main [
<a name="L96"></a><span id="L96" class="LineNr"> 96 </span>  <span class="Normal">x</span>:num<span class="Special"> &lt;- </span>copy <span class="Constant">1</span>
<a name="L97"></a><span id="L97" class="LineNr"> 97 </span>  x<span class="Special"> &lt;- </span>add x<span class="Delimiter">,</span> <span class="Constant">1</span>
<a name="L98"></a><span id="L98" class="LineNr"> 98 </span>]
<a name="L99"></a><span id="L99" class="LineNr"> 99 </span><span class="Comment"># x is in location 1</span>
<a name="L100"></a><span id="L100" class="LineNr">100 </span><span class="traceContains">+mem: storing 2 in location 1</span>
<a name="L101"></a><span id="L101" class="LineNr">101 </span>
<a name="L102"></a><span id="L102" class="LineNr">102 </span><span class="Delimiter">:(scenario transform_fills_in_missing_label_type)</span>
<a name="L103"></a><span id="L103" class="LineNr">103 </span><span class="muRecipe">def</span> main [
<a name="L104"></a><span id="L104" class="LineNr">104 </span>  jump +target
<a name="L105"></a><span id="L105" class="LineNr">105 </span>  <span class="Constant">1</span>:num<span class="Special"> &lt;- </span>copy <span class="Constant">0</span>
<a name="L106"></a><span id="L106" class="LineNr">106 </span>  +target
<a name="L107"></a><span id="L107" class="LineNr">107 </span>]
<a name="L108"></a><span id="L108" class="LineNr">108 </span><span class="traceAbsent">-mem: storing 0 in location 1</span>
<a name="L109"></a><span id="L109" class="LineNr">109 </span>
<a name="L110"></a><span id="L110" class="LineNr">110 </span><span class="Delimiter">:(scenario transform_fails_on_missing_types_in_first_mention)</span>
<a name="L111"></a><span id="L111" class="LineNr">111 </span><span class="Special">% Hide_errors = true;</span>
<a name="L112"></a><span id="L112" class="LineNr">112 </span><span class="muRecipe">def</span> main [
<a name="L113"></a><span id="L113" class="LineNr">113 </span>  x<span class="Special"> &lt;- </span>copy <span class="Constant">1</span>
<a name="L114"></a><span id="L114" class="LineNr">114 </span>  <span class="Normal">x</span>:num<span class="Special"> &lt;- </span>copy <span class="Constant">2</span>
<a name="L115"></a><span id="L115" class="LineNr">115 </span>]
<a name="L116"></a><span id="L116" class="LineNr">116 </span><span class="traceContains">+error: main: missing type for 'x' in 'x &lt;- copy 1'</span>
<a name="L117"></a><span id="L117" class="LineNr">117 </span>
<a name="L118"></a><span id="L118" class="LineNr">118 </span><span class="Delimiter">:(scenario transform_fails_on_wrong_type_for_label)</span>
<a name="L119"></a><span id="L119" class="LineNr">119 </span><span class="Special">% Hide_errors = true;</span>
<a name="L120"></a><span id="L120" class="LineNr">120 </span><span class="muRecipe">def</span> main [
<a name="L121"></a><span id="L121" class="LineNr">121 </span>  +foo:num<span class="Special"> &lt;- </span>copy <span class="Constant">34</span>
<a name="L122"></a><span id="L122" class="LineNr">122 </span>]
<a name="L123"></a><span id="L123" class="LineNr">123 </span><span class="traceContains">+error: main: non-label '+foo' must begin with a letter</span>
<a name="L124"></a><span id="L124" class="LineNr">124 </span>
<a name="L125"></a><span id="L125" class="LineNr">125 </span><span class="Delimiter">:(scenario typo_in_address_type_fails)</span>
<a name="L126"></a><span id="L126" class="LineNr">126 </span><span class="Special">% Hide_errors = true;</span>
<a name="L127"></a><span id="L127" class="LineNr">127 </span><span class="muRecipe">def</span> main [
<a name="L128"></a><span id="L128" class="LineNr">128 </span>  <span class="Normal">y</span>:&amp;:charcter<span class="Special"> &lt;- </span><span class="Normal">new</span> <span class="Constant">character:type</span>
<a name="L129"></a><span id="L129" class="LineNr">129 </span>  *y<span class="Special"> &lt;- </span>copy <span class="Constant">67</span>
<a name="L130"></a><span id="L130" class="LineNr">130 </span>]
<a name="L131"></a><span id="L131" class="LineNr">131 </span><span class="traceContains">+error: main: unknown type charcter in 'y:&amp;:charcter &lt;- new character:type'</span>
<a name="L132"></a><span id="L132" class="LineNr">132 </span>
<a name="L133"></a><span id="L133" class="LineNr">133 </span><span class="Delimiter">:(scenario array_type_without_size_fails)</span>
<a name="L134"></a><span id="L134" class="LineNr">134 </span><span class="Special">% Hide_errors = true;</span>
<a name="L135"></a><span id="L135" class="LineNr">135 </span><span class="muRecipe">def</span> main [
<a name="L136"></a><span id="L136" class="LineNr">136 </span>  <span class="Normal">x</span>:@:num<span class="Special"> &lt;- </span>merge <span class="Constant">2</span><span class="Delimiter">,</span> <span class="Constant">12</span><span class="Delimiter">,</span> <span class="Constant">13</span>
<a name="L137"></a><span id="L137" class="LineNr">137 </span>]
<a name="L138"></a><span id="L138" class="LineNr">138 </span><span class="traceContains">+error: main can't determine the size of array variable 'x'. Either allocate it separately and make the type of 'x' an address, or specify the length of the array in the type of 'x'.</span>
<a name="L139"></a><span id="L139" class="LineNr">139 </span>
<a name="L140"></a><span id="L140" class="LineNr">140 </span><span class="Delimiter">:(scenarios transform)</span>
<a name="L141"></a><span id="L141" class="LineNr">141 </span><span class="Delimiter">:(scenario transform_checks_types_of_identical_reagents_in_multiple_spaces)</span>
<a name="L142"></a><span id="L142" class="LineNr">142 </span><span class="muRecipe">def</span> foo [  <span class="Comment"># dummy</span>
<a name="L143"></a><span id="L143" class="LineNr">143 </span>]
<a name="L144"></a><span id="L144" class="LineNr">144 </span><span class="muRecipe">def</span> main [
<a name="L145"></a><span id="L145" class="LineNr">145 </span>  local-scope
<a name="L146"></a><span id="L146" class="LineNr">146 </span>  <span class="Constant">0</span>:space/names:foo<span class="Special"> &lt;- </span>copy <span class="Constant">0</span>  <span class="Comment"># specify surrounding space</span>
<a name="L147"></a><span id="L147" class="LineNr">147 </span>  <span class="Normal">x</span>:<span class="Normal">bool</span><span class="Special"> &lt;- </span>copy <span class="Constant">1</span>/<span class="Constant">true</span>
<a name="L148"></a><span id="L148" class="LineNr">148 </span>  <span class="Normal">x</span>:num/space:<span class="Constant">1</span><span class="Special"> &lt;- </span>copy <span class="Constant">34</span>
<a name="L149"></a><span id="L149" class="LineNr">149 </span>  x/space:<span class="Constant">1</span><span class="Special"> &lt;- </span>copy <span class="Constant">35</span>
<a name="L150"></a><span id="L150" class="LineNr">150 </span>]
<a name="L151"></a><span id="L151" class="LineNr">151 </span>$error: <span class="Constant">0</span>
<a name="L152"></a><span id="L152" class="LineNr">152 </span>
<a name="L153"></a><span id="L153" class="LineNr">153 </span><span class="Delimiter">:(scenario transform_handles_empty_reagents)</span>
<a name="L154"></a><span id="L154" class="LineNr">154 </span><span class="Special">% Hide_errors = true;</span>
<a name="L155"></a><span id="L155" class="LineNr">155 </span><span class="muRecipe">def</span> main [
<a name="L156"></a><span id="L156" class="LineNr">156 </span>  add *
<a name="L157"></a><span id="L157" class="LineNr">157 </span>]
<a name="L158"></a><span id="L158" class="LineNr">158 </span><span class="traceContains">+error: illegal name '*'</span>
<a name="L159"></a><span id="L159" class="LineNr">159 </span><span class="Comment"># no crash</span>
</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
