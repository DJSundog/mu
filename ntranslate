#!/bin/sh
# Translate SubX using the self-hosted translator.
#
# Possible knobs:
#   Whether to run a phase directly or emulated.
#     This script is for running natively.
#   Whether to stop after a phase.
#     Just always run all phases, but print out phases so it's clear where an error happens.
#   Whether to trace a phase. Whether to always trace or rerun with tracing enabled after an error.
#     Leave tracing to other scripts. We save intermediate files so it's easy to rerun a single phase afterwards.
#   Whether to run a phase with debug information. (Need to juggle multiple sets of debug files.)
#     Again, that's for subsequent scripts.

set -e

./build

echo "  tests"
cat $*          |apps/tests    > a.tests

echo "  dquotes"
cat a.tests     |apps/dquotes  > a.dquotes

echo "  assort"
cat a.dquotes   |apps/assort   > a.assort

echo "  pack"
cat a.assort    |apps/pack     > a.pack

echo "  survey"
cat a.pack      |apps/survey   > a.survey

echo "  hex"
cat a.survey    |apps/hex      > a.elf
